<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="个人Hibernate (Spring Data JPA) 入门整理"><title>Hibernate入门篇 - ORM真香</title>
<link rel=canonical href=https://c-poet.github.io/post/framework/spring/hibernate-orm-basic/><link rel=stylesheet href=/scss/style.min.0304c6baf04e01a8fe70693791cb744d56a3578a3120a8796cefc66825aa39c7.css><meta property='og:title' content="Hibernate入门篇 - ORM真香"><meta property='og:description' content="个人Hibernate (Spring Data JPA) 入门整理"><meta property='og:url' content='https://c-poet.github.io/post/framework/spring/hibernate-orm-basic/'><meta property='og:site_name' content='CPoet'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Spring'><meta property='article:tag' content='Hibernate'><meta property='article:tag' content='Spring-Data-Jpa'><meta property='article:published_time' content='2020-10-06T22:50:48+08:00'><meta property='article:modified_time' content='2020-10-06T22:50:48+08:00'><meta name=twitter:title content="Hibernate入门篇 - ORM真香"><meta name=twitter:description content="个人Hibernate (Spring Data JPA) 入门整理"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hub69c133b9baecf73314fbafde4b0bf83_88883_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🧑‍💻</span></figure><div class=site-meta><h1 class=site-name><a href=/>CPoet</a></h1><h2 class=site-description>心中若无梦，又何以致远。</h2></div></header><ol class=menu-social><li><a href=https://blog.csdn.net/qq_42304721 target=_blank title=CSDN rel=me><!doctype html><svg t="1719657462265" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="5267" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M530.9293681 431.99298667c12.69089853-1.39850077 32.17241993-2.81598184 58.96997255-2.81598184 44.75202505.0 80.92755642 7.8957922 103.33549032 24.51560657 20.13547797 15.48790009 33.52519552 40.55565997 29.81627827 76.89597458-3.43197786 33.81076231-20.74198383 57.48864879-45.99437 72.12071127-23.0981255099999 13.81332266-52.17848695 19.72136298-95.94526346 19.72136298-25.78555916.0-50.402969-1.41748106-69.11147578-4.22397275l18.9293681-186.21370082zm36.98564379 149.2013121c4.29730562.85583762 9.97499448 1.70218509 21.16558896 1.7021851 44.76151521.0 76.3265665-22.32511089 79.51007536-53.69690853 4.60098993-45.34127616-23.40180983-61.20619343-70.57468202-60.93011679-6.10129397.0-14.59496468.0-19.09501409.83685734L567.90552174 581.20378891h.0086274zm192.82056016-142.09665206c181.99921821-34.39915066 197.70797962 27.4144114 192.08550608 82.12331343L942.21024461 622.43066023H884.4550093l9.67131017-92.30191443c2.08955515-20.32786888 15.10225553-60.09239669-47.74228028-58.59209265-21.7272324.52454563-32.53131957 3.50617346-32.53131957 3.50617347s-1.88594862 24.56133176-4.16875743 42.71768524L798.70560163 622.43066023h-56.64143855l11.23631967-103.16035419" fill="#231916" p-id="5268"/><path d="M265.80433314 616.11799508c-10.67553898 3.74515232-32.81688637 6.31266516-63.76507889 6.31266515C113.06923991 622.43066023 65.05951037 580.09861956 70.72857184 524.15600002c6.80960313-66.67251112 77.93643846-104.18183779 155.82628898-104.18183779 30.17517791.0 47.92690654 2.46657234 64.58381871 6.58960456l-5.35588702 44.91767104c-11.06118355-3.78225011-37.00289858-7.25218852-58.00370429-7.25218852-45.84684153.0-84.76415912 13.84093033-89.22797347 57.59907945-3.97550376 39.12955153 23.3465945 57.8380583 74.89959531 57.8380583 17.94498229.0 44.41124294-2.60461066 56.64143856-6.35839035l-4.30679575 42.79188083.01898028.01725479z" fill="#c92027" p-id="5269"/><path d="M305.55937083 570.68440578c16.63793189 5.83470746 51.32264935 11.65043465 79.37203705 11.65043465 30.2209031.0 47.04346126-8.05194806 48.39623685-20.53061266 1.22336465-11.39247553-11.15349668-12.92987738-45.28606084-20.71437619-47.16338205-11.12675175-77.25573697-28.3349545-74.3103442-55.82356149C317.17270769 453.32508436 361.6115583 429.17700483 429.80249098 429.17700483c33.26723639.0 65.49487164 2.25433839 82.19750902 7.51877503l-5.74239433 40.26060304c-10.84032224-3.62523151-52.34413295-8.65931669-80.41163819-8.65931669-28.46350268.0-43.19736842 8.60410136-44.21885202 18.04592281-1.28807011 11.94549158 13.50963835 12.49764488 50.49441939 21.95758387 50.06218689 12.2120781 71.95506527 29.41079069 69.09335825 56.07116773C497.85538535 595.77977332 457.87085896 622.43066023 378.02949161 622.43066023c-33.23962873.0-61.89638506-5.83470746-77.68796948-11.66855218l5.21784869-40.07770228z" fill="#231916" p-id="5270"/></svg></a></li><li><a href=https://github.com/c-poet target=_blank title=GitHub rel=me><!doctype html><svg t="1719658035343" class="icon" viewBox="0 0 3786 1024" xmlns="http://www.w3.org/2000/svg" p-id="19106" xmlns:xlink="http://www.w3.org/1999/xlink" width="739.453125" height="200"><path d="M729.176289 438.294072H410.703618c-7.882987.0-14.977675 6.30639-14.977675 14.977675V608.56659c0 7.882987 6.30639 14.977675 14.977675 14.977675h123.762895v193.133179s-27.590454 9.459584-104.843726 9.459584c-90.654349.0-217.570439-33.108545-217.570439-312.166281s132.43418-316.107775 256.197075-316.107775c107.208622.0 153.718245 18.919169 182.885296 28.378752 9.459584 3.153195 18.13087-6.30639 18.13087-14.977675l35.473441-150.56505c0-3.941493-1.576597-8.671286-5.518091-11.82448C687.396459 40.991532 614.872979.0 430.411085.0 217.570439.0.0 90.654349.0 525.006928S249.102386 1024 459.578137 1024c174.214011.0 279.846035-74.100077 279.846035-74.100077 4.729792-2.364896 4.729792-8.671286 4.729793-11.036182V453.271747c0-8.671286-7.094688-14.977675-14.977676-14.977675zM2368.837567 52.027714c0-7.882987-6.30639-14.977675-14.977675-14.977676h-178.943803c-7.882987.0-14.977675 6.30639-14.977675 14.977676v346.063125h-279.057737V52.027714c0-7.882987-6.30639-14.977675-14.977675-14.977676H1686.959199c-7.882987.0-14.977675 6.30639-14.977675 14.977676v937.287144c0 7.882987 6.30639 14.977675 14.977675 14.977675h178.943803c7.882987.0 14.977675-7.094688 14.977675-14.977675V588.070824h279.057737l-.788299 401.244034c0 7.882987 6.30639 14.977675 14.977676 14.977675h179.732101c7.882987.0 14.977675-7.094688 14.977675-14.977675V52.027714z" fill="#100e0f" p-id="19107"/><path d="M1067.356428 175.002309c0-64.640493-52.027714-116.668206-115.879908-116.668206s-115.091609 52.027714-115.091609 116.668206c0 64.640493 52.027714 116.668206 115.091609 116.668207 63.852194.0 115.879908-52.027714 115.879908-116.668207zm-12.612779 616.449577V358.675905c0-7.882987-6.30639-14.977675-14.977675-14.977676H860.822171c-7.882987.0-15.765974 8.671286-15.765974 16.554273v619.602771c0 18.13087 11.036182 23.648961 26.013857 23.648961h160.812933c17.342571.0 22.072363-8.671286 22.072363-23.648961.788299-33.108545.788299-163.177829.788299-188.403387z" fill="#100e0f" p-id="19108"/><path d="M3049.139338 345.274827h-177.367206c-7.882987.0-14.977675 7.094688-14.977675 14.977675V819.830639s-44.933025 33.108545-109.573518 33.108545c-63.852194.0-81.194765-29.167052-81.194765-92.230947V360.252502c0-7.882987-6.30639-14.977675-14.977675-14.977675h-180.5204c-7.882987.0-14.977675 7.094688-14.977676 14.977675v431.199384c0 186.038491 104.055427 231.759815 246.737491 231.759815 117.456505.0 212.052348-64.640493 212.052348-64.640492s4.729792 33.896844 6.306389 37.838337c2.364896 3.941493 7.094688 7.882987 13.401078 7.882987l115.091609-.788299c7.882987.0 14.977675-7.094688 14.977675-14.977675V359.464203c0-7.094688-6.30639-14.189376-14.977675-14.189376zm486.380292-20.495766c-100.902232.0-169.484219 44.933025-169.484218 44.933025V52.027714c0-7.882987-6.30639-14.977675-14.977675-14.977676h-179.732102c-7.882987.0-14.977675 6.30639-14.977675 14.977676v937.287144c0 7.882987 6.30639 14.977675 14.977675 14.977675h124.551193c5.518091.0 10.247883-3.153195 12.612779-7.882987 3.153195-4.729792 7.882987-43.356428 7.882987-43.356428s73.311778 69.370285 212.840647 69.370285c163.177829.0 256.985373-82.771363 256.985373-372.076983-.788299-288.517321-149.776751-325.56736-250.678984-325.567359zm-70.158583 527.371824c-61.487298-1.576597-103.267129-29.95535-103.267129-29.95535V525.795227s40.991532-25.225558 92.230947-29.95535c63.852194-5.518091 125.339492 13.401078 125.339492 166.331024-.788299 160.812933-28.378753 193.133179-114.30331 189.979984zM1569.502694 343.698229h-134.010777V166.331024c0-7.094688-3.153195-10.247883-11.036182-10.247883h-182.885296c-7.094688.0-11.036182 3.153195-11.036182 10.247883v183.673595s-91.442648 22.072363-97.749038 23.648961c-6.30639 1.576597-11.036182 7.882987-11.036181 14.189376v115.091609c0 8.671286 6.30639 14.977675 14.977675 14.977675h93.807544v277.48114c0 205.745958 144.258661 226.241724 242.007698 226.241724 44.933025.0 97.749038-14.189376 106.420324-17.342571 5.518091-1.576597 8.671286-7.094688 8.671285-13.401078V863.975366c0-7.882987-7.094688-14.977675-14.977675-14.977675-7.882987.0-27.590454 3.153195-48.874519 3.153194-66.21709.0-88.289453-30.743649-88.289453-70.158583V518.700539h134.010777c7.882987.0 14.977675-6.30639 14.977676-14.977675V358.675905c-.788299-7.882987-7.094688-14.977675-14.977676-14.977676z" fill="#100e0f" p-id="19109"/></svg></a></li><li><a href=https://www.cnblogs.com/cpoet target=_blank title=博客园 rel=me><!doctype html><svg t="1719667888485" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="3218" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M478.71488 33.88416c-75.76064 36.6592-123.11552 117.31456-114.82624 194.82624 8.28416 67.03616 43.8016 120.45824 104.17152 156.06784C655.09888 494.76096 887.1168 305.17248 784.128 126.05952 722.57536 20.26496 591.17568-19.53792 478.71488 33.88416zm187.03872 67.03616c85.23264 52.37248 80.49664 188.53888-9.472 229.39136-104.17152 48.18432-213.07904-15.71328-213.07904-125.696.0-41.89696 5.91872-54.46656 40.24832-84.84352s48.5376-35.61472 98.2528-35.61472c33.14688.00512 68.6592 7.33696 84.04992 16.76288z" fill="#333" p-id="3219"/><path d="M797.15328 340.7872c-63.9232 115.22048-89.96864 148.736-164.54656 217.87136-75.76064 71.22432-105.35424 90.08128-209.53088 135.12192-67.47648 29.32736-132.5824 50.2784-147.97312 48.18432-22.49216-2.09408-36.69504-25.1392-88.78592-139.31008C120.02816 458.10176 53.73952 333.45536 25.32864 298.89024 8.7552 278.9888 7.57248 280.0384 13.4912 309.36576 40.71424 465.4336 133.05344 774.43072 161.46432 803.75808c15.39072 17.80736 295.94624 18.85184 456.93952 2.09408 190.58688-19.90144 170.46528-27.23328-121.92768-47.13472l-106.54208-7.33184 102.9888-24.0896c114.82624-27.23328 177.56672-52.37248 261.61664-105.79456C786.50368 601.6 817.28 586.93632 824.38144 589.0304c5.91872 2.09408 49.72032 98.46272 94.70464 212.6336 46.16704 115.22048 86.41536 212.6336 91.15136 216.82176 11.83744 11.52-8.28416-233.57952-28.41088-358.22592-10.65472-60.75392-39.0656-187.4944-63.9232-282.81344l-44.98432-172.83072-75.76576 136.17152z" fill="#333" p-id="3220"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>首页</span></a></li><li><a href=/page/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>分类</span></a></li><li><a href=/page/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li><a href=/page/projects/><!doctype html><svg t="1719657607322" class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" p-id="13066" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M98.3 540.2l2.3 2.1 345.3 189.1c17.6 14.7 40.5 22.8 64.6 22.8s47-8.1 64.6-22.8l344.8-188.8.5-.3 2.3-2.1c34.8-31.3 39-82 9.8-118-1.7-2.1-4.9-2.5-7-.7l-33.7 27.4c-2.1 1.7-2.5 4.9-.7 7 10.6 13 9.7 30.5-2.1 42.7L544.7 687.1l-.5.3-2.3 2.1c-17 15.3-45.8 15.3-62.8.0l-2.3-2.1-344.7-188.8c-11.8-12.2-12.7-29.7-2.1-42.7 1.7-2.1 1.4-5.3-.7-7l-33.7-27.4c-2.1-1.7-5.3-1.4-7 .7-29.4 35.9-25.1 86.7 9.7 118z" fill="#424242" p-id="13067"/><path d="M925.5 608.3l-33.7 27.4c-2.1 1.7-2.5 4.9-.7 7 10.6 13 9.7 30.5-2.1 42.7L544.7 873.9l-.5.3-2.3 2.1c-17 15.3-45.8 15.3-62.8.0l-2.3-2.1-344.7-188.8c-11.8-12.2-12.7-29.7-2.1-42.7 1.7-2.1 1.4-5.3-.7-7l-33.7-27.4c-2.1-1.7-5.3-1.4-7 .7-29.2 35.9-25 86.7 9.8 118l2.3 2.1L446 918.2c17.6 14.7 40.5 22.8 64.6 22.8s47-8.1 64.6-22.8L920 729.4l.5-.3 2.3-2.1c34.8-31.3 39-82 9.8-118-1.8-2.1-4.9-2.5-7.1-.7zM116.1 372.6l54.5 29.8 290.6 159.1c27.2 24.5 71.4 24.5 98.6.0l290.6-159.1 54.5-29.8c2.6-2.3 4.9-4.8 7-7.4 19.9-24.5 17.7-59.1-7-81.3L559.8 99.3c-27.2-24.5-71.4-24.5-98.6.0L116.1 283.9c-24.6 22.2-26.9 56.7-7 81.3 2.2 2.6 4.4 5.1 7 7.4z" fill="#424242" p-id="13068"/></svg>
<span>项目</span></a></li><li><a href=/page/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>关于</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#hibernate架构>Hibernate架构</a><ol><li><a href=#配置对象>配置对象</a></li><li><a href=#sessionfactory对象>SessionFactory对象</a></li><li><a href=#session对象>Session对象</a></li><li><a href=#transaction对象>Transaction对象</a></li><li><a href=#query对象>Query对象</a></li><li><a href=#criteria>Criteria</a></li></ol></li><li><a href=#引入hibernate>引入Hibernate</a><ol><li><a href=#手动引入>手动引入</a></li><li><a href=#maven>maven</a></li></ol></li><li><a href=#hibernatecfgxml配置文件>hibernate.cfg.xml配置文件</a><ol><li><a href=#几个重要的配置属性>几个重要的配置属性</a></li><li><a href=#数据库方言>数据库方言</a></li></ol></li><li><a href=#简单的xml映射文件>简单的XML映射文件</a><ol><li><a href=#hibernate-type预设值>hibernate type预设值</a><ol><li><a href=#原始类型>原始类型</a></li><li><a href=#日期和时间类型>日期和时间类型</a></li><li><a href=#二进制和大型数据类型>二进制和大型数据类型</a></li><li><a href=#jdk相关类型>JDK相关类型</a></li></ol></li></ol></li><li><a href=#映射注解>映射注解</a><ol><li><ol><li><a href=#entity>@Entity</a></li><li><a href=#table>@Table</a></li><li><a href=#id>@Id</a></li><li><a href=#generatedvalue>@GeneratedValue</a></li><li><a href=#column>@Column</a></li><li><a href=#dynamicupdate和dynamicinsert>@DynamicUpdate和@DynamicInsert</a></li><li><a href=#实体关系表间关系>实体关系（表间关系）</a></li></ol></li></ol></li><li><a href=#创建会话session>创建会话（Session）</a><ol><li><a href=#sessionfactory>SessionFactory</a></li><li><a href=#打开会话>打开会话</a></li></ol></li><li><a href=#hql-hibernate-query-language>HQL (hibernate query language)</a><ol><li><a href=#select语句>SELECT语句</a></li><li><a href=#动态参数>动态参数</a></li><li><a href=#delete语句>DELETE语句</a></li><li><a href=#update语句>UPDATE语句</a></li><li><a href=#insert语句>INSERT语句</a></li><li><a href=#where-子句>WHERE 子句</a></li><li><a href=#as关键字>AS关键字</a></li><li><a href=#order-by-排序>ORDER BY 排序</a></li><li><a href=#group-by-分组>GROUP BY 分组</a></li><li><a href=#分页查询>分页查询</a></li><li><a href=#聚合函数>聚合函数</a></li></ol></li><li><a href=#标准查询>标准查询</a></li><li><a href=#原生查询>原生查询</a></li><li><a href=#interceptor-拦截器>interceptor 拦截器</a><ol><li><a href=#拦截器常用方法解释>拦截器常用方法解释</a></li><li><a href=#使用自定义拦截器>使用自定义拦截器</a></li></ol></li><li><a href=#hibernate缓存>hibernate缓存</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/framework/spring/ style=background-color:#6eb141;color:#fff>Spring 全家桶</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/framework/spring/hibernate-orm-basic/>Hibernate入门篇 - ORM真香</a></h2><h3 class=article-subtitle>个人Hibernate (Spring Data JPA) 入门整理</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2020-10-06 22:50</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 13 分钟</time></div></footer></div></header><section class=article-content><h2 id=hibernate架构>Hibernate架构</h2><p>Hibernate架构图：</p><p><img src=/post/framework/spring/hibernate-orm-basic/20201006230334202.jpg width=460 height=374 srcset="/post/framework/spring/hibernate-orm-basic/20201006230334202_hu8346dbe188769a6c1ad1d211deed9768_27580_480x0_resize_q75_box.jpg 480w, /post/framework/spring/hibernate-orm-basic/20201006230334202_hu8346dbe188769a6c1ad1d211deed9768_27580_1024x0_resize_q75_box.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=122 data-flex-basis=295px></p><p>Hibernate 使用不同的现存 Java API，比如 JDBC，Java 事务 API（JTA），以及 Java 命名和目录界面（JNDI）。JDBC 提供了一个基本的抽象级别的通用关系数据库的功能， Hibernate 支持几乎所有带有 JDBC 驱动的数据库。JNDI 和 JTA 允许 Hibernate 与 J2EE 应用程序服务器相集成。</p><h3 id=配置对象>配置对象</h3><p>配置对象是你在任何 Hibernate 应用程序中创造的第一个 Hibernate 对象，并且经常只在应用程序初始化期间创造。它代表了 Hibernate 所需一个配置或属性文件。配置对象提供了两种基础组件。</p><ul><li><strong>数据库连接</strong>：由 Hibernate 支持的一个或多个配置文件处理。这些文件是 <strong>hibernate.properties</strong> 和 <strong>hibernate.cfg.xml</strong>。</li><li><strong>类映射设置</strong>：这个组件创造了 Java 类和数据库表格之间的联系。</li></ul><h3 id=sessionfactory对象>SessionFactory对象</h3><p>配置对象是你在任何 Hibernate 应用程序中创造的第一个 Hibernate 对象，并且经常只在应用程序初始化期间创造。它代表了 Hibernate 所需一个配置或属性文件。配置对象提供了两种基础组件。</p><ul><li><strong>数据库连接</strong>：由 Hibernate 支持的一个或多个配置文件处理。这些文件是 <strong>hibernate.properties</strong> 和 <strong>hibernate.cfg.xml</strong>。</li><li><strong>类映射设置</strong>：这个组件创造了 Java 类和数据库表格之间的联系。</li></ul><h3 id=session对象>Session对象</h3><p>配置对象是你在任何 Hibernate 应用程序中创造的第一个 Hibernate 对象，并且经常只在应用程序初始化期间创造。它代表了 Hibernate 所需一个配置或属性文件。配置对象提供了两种基础组件。</p><ul><li><strong>数据库连接</strong>：由 Hibernate 支持的一个或多个配置文件处理。这些文件是 <strong>hibernate.properties</strong> 和 <strong>hibernate.cfg.xml</strong>。</li><li><strong>类映射设置</strong>：这个组件创造了 Java 类和数据库表格之间的联系。</li></ul><h3 id=transaction对象>Transaction对象</h3><p>配置对象是你在任何 Hibernate 应用程序中创造的第一个 Hibernate 对象，并且经常只在应用程序初始化期间创造。它代表了 Hibernate 所需一个配置或属性文件。配置对象提供了两种基础组件。</p><ul><li><strong>数据库连接</strong>：由 Hibernate 支持的一个或多个配置文件处理。这些文件是 <strong>hibernate.properties</strong> 和 <strong>hibernate.cfg.xml</strong>。</li><li><strong>类映射设置</strong>：这个组件创造了 Java 类和数据库表格之间的联系。</li></ul><h3 id=query对象>Query对象</h3><p>Query 对象使用 SQL 或者 Hibernate 查询语言（HQL）字符串在数据库中来检索数据并创造对象。一个查询的实例被用于连结查询参数，限制由查询返回的结果数量，并最终执行查询。</p><h3 id=criteria>Criteria</h3><p>Criteria 对象被用于创造和执行面向规则查询的对象来检索对象。可以利用该类来完成非sql语句的数据过滤查询。</p><h2 id=引入hibernate>引入Hibernate</h2><h3 id=手动引入>手动引入</h3><p>在Hibernate官网<a class=link href=http://hibernate.org/orm/releases/ target=_blank rel=noopener>http://hibernate.org/orm/releases/</a>下载合适版本的资料，其中包括hibernate的源码、编译好的jar包和文档信息。</p><p>对于普通使用只需要把<code>lib\required</code>目录下的jar包引入项目，对于缓存的使用，需要引入<code>lib\optional\ehcache</code>目录下的<code>EHCache</code>的jar包。</p><h3 id=maven>maven</h3><p>hibernate包</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.hibernate<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>hibernate-core<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>5.4.21.Final<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>缓存Ehcache</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;dependency&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;groupId&gt;</span>org.hibernate<span class=nt>&lt;/groupId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;artifactId&gt;</span>hibernate-ehcache<span class=nt>&lt;/artifactId&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;version&gt;</span>5.4.21.Final<span class=nt>&lt;/version&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Hibernate6目前还处于测试版。</p><p><strong>使用之前还需要引入对应自己DataBase的JDBC驱动。</strong></p><h2 id=hibernatecfgxml配置文件>hibernate.cfg.xml配置文件</h2><p><code>hibernate.cfg.xml</code>是hibernate配置文件的默认文件名，只需要将hibernate.cfg.xml文件放在项目目录下，hibernate将自动读取文件中的配置。(<strong>对于普通的java项目，hibernate.cfg.xml应该放在src目录下</strong>)</p><p>通常需要配置SQL方言、连接驱动、数据库url地址、用户名和密码等。可以使用<code>mapping</code>标签来指示映射文件路径，可以同hibernate的配置文件放在项目根目录下。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE hibernate-configuration SYSTEM
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;hibernate-configuration&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--    配置一个session工厂--&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;session-factory&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!--        sql方言--&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;hibernate.dialect&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            org.hibernate.dialect.MySQLDialect
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/property&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&lt;!--        jdbc驱动--&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;hibernate.connection.driver_class&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            com.mysql.cj.jdbc.Driver
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/property&gt;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl><span class=c>&lt;!--        数据库链接--&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;hibernate.connection.url&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            jdbc:mysql://localhost:3306/hibernate_study?serverTimezone=UTC
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/property&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&lt;!--        用户名--&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;hibernate.connection.username&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            dev
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/property&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&lt;!--        密码--&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;hibernate.connection.password&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            123456
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/property&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&lt;!--        映射文件--&gt;</span>
</span></span><span class=line><span class=cl>        <span class=c>&lt;!-- 支持package、class、file、jar --&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;mapping</span> <span class=na>resource=</span><span class=s>&#34;User.hbm.xml&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/session-factory&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/hibernate-configuration&gt;</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=几个重要的配置属性>几个重要的配置属性</h3><div class=table-wrapper><table><thead><tr><th style=text-align:left>NO</th><th style=text-align:left><strong>属性和描述</strong></th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left><strong>hibernate.connection.datasource</strong><br>在应用程序服务器环境中您正在使用的应用程序 JNDI 名。</td></tr><tr><td style=text-align:left>2</td><td style=text-align:left><strong>hibernate.jndi.class</strong><br>JNDI 的 InitialContext 类。</td></tr><tr><td style=text-align:left>3</td><td style=text-align:left><strong>hibernate.jndi.<jndipropertyname></strong><br>在 JNDI的 InitialContext 类中通过任何你想要的 Java 命名和目录接口属性。</td></tr><tr><td style=text-align:left>4</td><td style=text-align:left><strong>hibernate.jndi.url</strong><br>为 JNDI 提供 URL。</td></tr><tr><td style=text-align:left>5</td><td style=text-align:left><strong>hibernate.connection.username</strong><br>数据库用户名。</td></tr><tr><td style=text-align:left>6</td><td style=text-align:left><strong>hibernate.connection.password</strong><br>数据库密码。</td></tr></tbody></table></div><h3 id=数据库方言>数据库方言</h3><div class=table-wrapper><table><thead><tr><th style=text-align:left><strong>数据库</strong></th><th style=text-align:left><strong>方言属性</strong></th></tr></thead><tbody><tr><td style=text-align:left>DB2</td><td style=text-align:left>org.hibernate.dialect.DB2Dialect</td></tr><tr><td style=text-align:left>HSQLDB</td><td style=text-align:left>org.hibernate.dialect.HSQLDialect</td></tr><tr><td style=text-align:left>HypersonicSQL</td><td style=text-align:left>org.hibernate.dialect.HSQLDialect</td></tr><tr><td style=text-align:left>Informix</td><td style=text-align:left>org.hibernate.dialect.InformixDialect</td></tr><tr><td style=text-align:left>Ingres</td><td style=text-align:left>org.hibernate.dialect.IngresDialect</td></tr><tr><td style=text-align:left>Interbase</td><td style=text-align:left>org.hibernate.dialect.InterbaseDialect</td></tr><tr><td style=text-align:left>Microsoft SQL Server 2000</td><td style=text-align:left>org.hibernate.dialect.SQLServerDialect</td></tr><tr><td style=text-align:left>Microsoft SQL Server 2005</td><td style=text-align:left>org.hibernate.dialect.SQLServer2005Dialect</td></tr><tr><td style=text-align:left>Microsoft SQL Server 2008</td><td style=text-align:left>org.hibernate.dialect.SQLServer2008Dialect</td></tr><tr><td style=text-align:left>MySQL</td><td style=text-align:left>org.hibernate.dialect.MySQLDialect</td></tr><tr><td style=text-align:left>Oracle (any version)</td><td style=text-align:left>org.hibernate.dialect.OracleDialect</td></tr><tr><td style=text-align:left>Oracle 11g</td><td style=text-align:left>org.hibernate.dialect.Oracle10gDialect</td></tr><tr><td style=text-align:left>Oracle 10g</td><td style=text-align:left>org.hibernate.dialect.Oracle10gDialect</td></tr><tr><td style=text-align:left>Oracle 9i</td><td style=text-align:left>org.hibernate.dialect.Oracle9iDialect</td></tr><tr><td style=text-align:left>PostgreSQL</td><td style=text-align:left>org.hibernate.dialect.PostgreSQLDialect</td></tr><tr><td style=text-align:left>Progress</td><td style=text-align:left>org.hibernate.dialect.ProgressDialect</td></tr><tr><td style=text-align:left>SAP DB</td><td style=text-align:left>org.hibernate.dialect.SAPDBDialect</td></tr><tr><td style=text-align:left>Sybase</td><td style=text-align:left>org.hibernate.dialect.SybaseDialect</td></tr><tr><td style=text-align:left>Sybase Anywhere</td><td style=text-align:left>org.hibernate.dialect.SybaseAnywhereDialec</td></tr></tbody></table></div><h2 id=简单的xml映射文件>简单的XML映射文件</h2><p>所有的Entity应该是按照java bean的要求编写的POJO对象，以User Entity为例。</p><p>User Entity:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>package</span><span class=w> </span><span class=nn>cn.llzero.entity</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.io.Serializable</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>pass</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Character</span><span class=w> </span><span class=n>sex</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=nf>getId</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=nf>setId</span><span class=p>(</span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getName</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=nf>setName</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getPass</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>pass</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=nf>setPass</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>pass</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>pass</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>pass</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Character</span><span class=w> </span><span class=nf>getSex</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=n>sex</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=nf>setSex</span><span class=p>(</span><span class=n>Character</span><span class=w> </span><span class=n>sex</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>this</span><span class=p>.</span><span class=na>sex</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sex</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=k>this</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>toString</span><span class=p>()</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=s>&#34;User{&#34;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;id=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;, name=&#39;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=sc>&#39;\&#39;&#39;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;, pass=&#39;&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>pass</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=sc>&#39;\&#39;&#39;</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;, sex=&#34;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>sex</span><span class=w> </span><span class=o>+</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=sc>&#39;}&#39;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>XML映射文件（User.hbm.xml）:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE hibernate-mapping PUBLIC
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;-//Hibernate/Hibernate Mapping DTD//EN&#34;
</span></span></span><span class=line><span class=cl><span class=cp>        &#34;http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;hibernate-mapping&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;class</span> <span class=na>name=</span><span class=s>&#34;cn.llzero.entity.User&#34;</span> <span class=na>table=</span><span class=s>&#34;user&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;meta</span> <span class=na>attribute=</span><span class=s>&#34;description&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            User映射，学习Hibernate
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/meta&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;id</span> <span class=na>name=</span><span class=s>&#34;id&#34;</span> <span class=na>column=</span><span class=s>&#34;id&#34;</span> <span class=na>type=</span><span class=s>&#34;integer&#34;</span> <span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>            <span class=nt>&lt;generator</span> <span class=na>class=</span><span class=s>&#34;native&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;/id&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;name&#34;</span> <span class=na>column=</span><span class=s>&#34;name&#34;</span> <span class=na>unique=</span><span class=s>&#34;true&#34;</span> <span class=na>type=</span><span class=s>&#34;string&#34;</span> <span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;pass&#34;</span> <span class=na>column=</span><span class=s>&#34;pass&#34;</span> <span class=na>type=</span><span class=s>&#34;string&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;property</span> <span class=na>name=</span><span class=s>&#34;sex&#34;</span> <span class=na>column=</span><span class=s>&#34;sex&#34;</span> <span class=na>type=</span><span class=s>&#34;char&#34;</span><span class=nt>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/class&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/hibernate-mapping&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>name => 对应实体的属性， column => 数据库字段， type指示了数据的类型，该属性建议使用hibernate的预设值。</p><h3 id=hibernate-type预设值>hibernate type预设值</h3><p>当你准备一个 Hibernate 映射文件时，我们已经看到你把 Java 数据类型映射到了 RDBMS 数据格式。在映射文件中已经声明被使用的 <strong>types</strong> 不是 Java 数据类型；它们也不是 SQL 数据库类型。这种类型被称为 Hibernate 映射类型，可以从 Java 翻译成 SQL，反之亦然。</p><p>在这一章中列举出所有的基础，日期和时间，大型数据对象，和其它内嵌的映射数据类型。</p><h4 id=原始类型>原始类型</h4><div class=table-wrapper><table><thead><tr><th style=text-align:left>映射类型</th><th style=text-align:left>Java 类型</th><th style=text-align:left>ANSI SQL 类型</th></tr></thead><tbody><tr><td style=text-align:left>integer</td><td style=text-align:left>int 或 java.lang.Integer</td><td style=text-align:left>INTEGER</td></tr><tr><td style=text-align:left>long</td><td style=text-align:left>long 或 java.lang.Long</td><td style=text-align:left>BIGINT</td></tr><tr><td style=text-align:left>short</td><td style=text-align:left>short 或 java.lang.Short</td><td style=text-align:left>SMALLINT</td></tr><tr><td style=text-align:left>float</td><td style=text-align:left>float 或 java.lang.Float</td><td style=text-align:left>FLOAT</td></tr><tr><td style=text-align:left>double</td><td style=text-align:left>double 或 java.lang.Double</td><td style=text-align:left>DOUBLE</td></tr><tr><td style=text-align:left>big_decimal</td><td style=text-align:left>java.math.BigDecimal</td><td style=text-align:left>NUMERIC</td></tr><tr><td style=text-align:left>character</td><td style=text-align:left>java.lang.String</td><td style=text-align:left>CHAR(1)</td></tr><tr><td style=text-align:left>string</td><td style=text-align:left>java.lang.String</td><td style=text-align:left>VARCHAR</td></tr><tr><td style=text-align:left>byte</td><td style=text-align:left>byte 或 java.lang.Byte</td><td style=text-align:left>TINYINT</td></tr><tr><td style=text-align:left>boolean</td><td style=text-align:left>boolean 或 java.lang.Boolean</td><td style=text-align:left>BIT</td></tr><tr><td style=text-align:left>yes/no</td><td style=text-align:left>boolean 或 java.lang.Boolean</td><td style=text-align:left>CHAR(1) (&lsquo;Y&rsquo; or &lsquo;N&rsquo;)</td></tr><tr><td style=text-align:left>true/false</td><td style=text-align:left>boolean 或 java.lang.Boolean</td><td style=text-align:left>CHAR(1) (&lsquo;T&rsquo; or &lsquo;F&rsquo;)</td></tr></tbody></table></div><h4 id=日期和时间类型>日期和时间类型</h4><div class=table-wrapper><table><thead><tr><th style=text-align:left>映射类型</th><th style=text-align:left>Java 类型</th><th style=text-align:left>ANSI SQL 类型</th></tr></thead><tbody><tr><td style=text-align:left>date</td><td style=text-align:left>java.util.Date 或 java.sql.Date</td><td style=text-align:left>DATE</td></tr><tr><td style=text-align:left>time</td><td style=text-align:left>java.util.Date 或 java.sql.Time</td><td style=text-align:left>TIME</td></tr><tr><td style=text-align:left>timestamp</td><td style=text-align:left>java.util.Date 或 java.sql.Timestamp</td><td style=text-align:left>TIMESTAMP</td></tr><tr><td style=text-align:left>calendar</td><td style=text-align:left>java.util.Calendar</td><td style=text-align:left>TIMESTAMP</td></tr><tr><td style=text-align:left>calendar_date</td><td style=text-align:left>java.util.Calendar</td><td style=text-align:left>DATE</td></tr></tbody></table></div><h4 id=二进制和大型数据类型>二进制和大型数据类型</h4><div class=table-wrapper><table><thead><tr><th style=text-align:left>映射类型</th><th style=text-align:left>Java 类型</th><th style=text-align:left>ANSI SQL 类型</th></tr></thead><tbody><tr><td style=text-align:left>binary</td><td style=text-align:left>byte[]</td><td style=text-align:left>VARBINARY (or BLOB)</td></tr><tr><td style=text-align:left>text</td><td style=text-align:left>java.lang.String</td><td style=text-align:left>CLOB</td></tr><tr><td style=text-align:left>serializable</td><td style=text-align:left>any Java class that implements java.io.Serializable</td><td style=text-align:left>VARBINARY (or BLOB)</td></tr><tr><td style=text-align:left>clob</td><td style=text-align:left>java.sql.Clob</td><td style=text-align:left>CLOB</td></tr><tr><td style=text-align:left>blob</td><td style=text-align:left>java.sql.Blob</td><td style=text-align:left>BLOB</td></tr></tbody></table></div><h4 id=jdk相关类型>JDK相关类型</h4><div class=table-wrapper><table><thead><tr><th style=text-align:left>映射类型</th><th style=text-align:left>Java 类型</th><th style=text-align:left>ANSI SQL 类型</th></tr></thead><tbody><tr><td style=text-align:left>class</td><td style=text-align:left>java.lang.Class</td><td style=text-align:left>VARCHAR</td></tr><tr><td style=text-align:left>locale</td><td style=text-align:left>java.util.Locale</td><td style=text-align:left>VARCHAR</td></tr><tr><td style=text-align:left>timezone</td><td style=text-align:left>java.util.TimeZone</td><td style=text-align:left>VARCHAR</td></tr><tr><td style=text-align:left>currency</td><td style=text-align:left>java.util.Currency</td><td style=text-align:left>VARCHAR</td></tr></tbody></table></div><p>对应的sql：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>create</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=k>user</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>id</span><span class=w>   </span><span class=kt>int</span><span class=w> </span><span class=kp>auto_increment</span><span class=w> </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>name</span><span class=w> </span><span class=kt>varchar</span><span class=p>(</span><span class=mi>20</span><span class=p>)</span><span class=w>      </span><span class=k>not</span><span class=w> </span><span class=no>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>pass</span><span class=w> </span><span class=kt>varchar</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span><span class=w>      </span><span class=k>not</span><span class=w> </span><span class=no>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>sex</span><span class=w>  </span><span class=kt>char</span><span class=w> </span><span class=k>default</span><span class=w> </span><span class=s1>&#39;M&#39;</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=no>null</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>constraint</span><span class=w> </span><span class=n>name</span><span class=w> </span><span class=k>unique</span><span class=w> </span><span class=p>(</span><span class=n>name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=kp>charset</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>utf8</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=映射注解>映射注解</h2><p>使用hibernate的注解比使用xml映射文件的方式方便，而且具有良好的可观性。特别是在spring推崇的去文档化，尽量减少对xml这类文档的依赖，采用编程的方式解决配置等问题。</p><h4 id=entity>@Entity</h4><p><code>@Entity</code>用于对POJO实体类注解，以明确这是一个实体类。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=table>@Table</h4><p><code>@Table</code>用于注解实体对应的表。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=id>@Id</h4><p><code>@Id</code>用于对<code>primark key</code>主键属性的注解。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=generatedvalue>@GeneratedValue</h4><p><code>@GeneratedValue</code>注解指示了属性值的生成策略，通常选用<code>GenerationType.AUTO</code>即可。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w> </span><span class=nd>@GeneratedValue</span><span class=p>(</span><span class=n>strategy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GenerationType</span><span class=p>.</span><span class=na>AUTO</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>GenerationType.AUTO : 自动选择</p><p>GenerationType.SEQUENCE : 按顺序自增</p><p>GenerationType.Table : 按值表的方式，由hibernate生成一个主键表</p><p>GenerationType.IDENTITY : 保持与entity一致</p><h4 id=column>@Column</h4><p><code>@Column</code>注解用于映射实体的<strong>属性</strong>和表的<strong>字段</strong>的关系。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Id</span><span class=w> </span><span class=nd>@GeneratedValue</span><span class=p>(</span><span class=n>strategy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>GenerationType</span><span class=p>.</span><span class=na>AUTO</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Integer</span><span class=w> </span><span class=n>id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Column</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;name&#34;</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=n>unique</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>true</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>name</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=dynamicupdate和dynamicinsert>@DynamicUpdate和@DynamicInsert</h4><p>指示在对象的更新与插入时，过滤null值的属性。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicInsert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h4 id=实体关系表间关系>实体关系（表间关系）</h4><p>对于<strong>关系模式</strong>的表间关系有一对一、一对多、多对多的关系，可以通过注解的方式来完成实体间的关系。</p><p>注意：在完成对象关系时，有关系“提供方”和“使用方”。关系的提供方要维护两者关系，负责对数据的操作。</p><p>对于一对一和多对多，维护方按照实际对象关系确定即可，对于一对多的方式，维护方只能为<strong>一的那个对象</strong>。</p><h5 id=onetoone-一对一>@OneToOne (一对一)</h5><p>现在有User和Role两个类，假设一个用户只能有一个角色，一个角色只能属于一个用户。</p><p>对于User类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicInsert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@OneToOne</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@JoinColumn</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;role_id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>referencedColumnName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Role</span><span class=w> </span><span class=n>role</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>对于Role类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;role&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicInsert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Role</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@OneToOne</span><span class=p>(</span><span class=n>mappedBy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;role&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=onetomany-一对多>@OneToMany (一对多)</h5><p>假设一个用户有多个角色，一个角色只能属于一个用户。</p><p>对于User类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicInsert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@OneToMany</span><span class=p>(</span><span class=n>mappedBy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Set</span><span class=o>&lt;</span><span class=n>Role</span><span class=o>&gt;</span><span class=w> </span><span class=n>roles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashSet</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>对于Role类：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;role&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicInsert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Role</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ManyToOne</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@JoinColumn</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user_id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>referencedColumnName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>User</span><span class=w> </span><span class=n>user</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h5 id=manytomany-多对多>@ManyToMany (多对多)</h5><p>假设一个用户可以有多个角色 ，一个角色可以属于多个用户。（<strong>注意：多对多的情况需要准备中间表。</strong>）</p><p>根据实际分析，由User来作关系的维护者。</p><p>对于User类:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicInsert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>User</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// @JoinColumns定义了中间表的信息</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ManyToMany</span><span class=p>(</span><span class=n>targetEntity</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Role</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@JoinTable</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user_role&#34;</span><span class=p>,</span><span class=w> </span><span class=n>joinColumns</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=nd>@JoinColumn</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;user_id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>referencedColumnName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>,</span><span class=w> </span><span class=n>inverseJoinColumns</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=nd>@JoinColumn</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;role_id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>referencedColumnName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>nullable</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=kc>false</span><span class=p>)})</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Set</span><span class=o>&lt;</span><span class=n>Role</span><span class=o>&gt;</span><span class=w> </span><span class=n>roles</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashSet</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>对于Role类:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Entity</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@Table</span><span class=p>(</span><span class=n>name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;role&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicInsert</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nd>@DynamicUpdate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Role</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@ManyToMany</span><span class=p>(</span><span class=n>mappedBy</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;roles&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>private</span><span class=w> </span><span class=n>Set</span><span class=o>&lt;</span><span class=n>User</span><span class=o>&gt;</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>HashSet</span><span class=o>&lt;&gt;</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=创建会话session>创建会话（Session）</h2><p>创建会话首先需要SessionFactory，可以通过<code>Configuration</code>读取hibernate的配置文件，或者通过setProperty的方式设定hibernate的属性。</p><h3 id=sessionfactory>SessionFactory</h3><ol><li><p>读取项目目录下的默认配置文件(hibernate.cfg.xml)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 以下语句将使用默认的hibernate.cfg.xml配置文件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>SessionFactory</span><span class=w> </span><span class=n>FACOTRY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Configuration</span><span class=p>().</span><span class=na>configure</span><span class=p>().</span><span class=na>buildSessionFactory</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>指定配置文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 指定配置文件，只需要在invoke configure方法时传入配置文件信息</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// configure方法原型如下：</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>configure</span><span class=p>();</span><span class=w>		</span><span class=c1>// 读取hibernate.cfg.xml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 以下自定义配置文件名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>configure</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>resource</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>configure</span><span class=p>(</span><span class=n>URL</span><span class=w> </span><span class=n>url</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>configure</span><span class=p>(</span><span class=n>File</span><span class=w> </span><span class=n>configFile</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li><li><p>通过编程方式设定
setProperty方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 一个简单的例子如下：</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>Configuration</span><span class=p>().</span><span class=na>configure</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setProperty</span><span class=p>(</span><span class=s>&#34;hibernate.dialect&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;org.hibernate.dialect.MySQLDialect&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setProperty</span><span class=p>(</span><span class=s>&#34;hibernate.connection.driver_class&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;com.mysql.cj.jdbc.Driver&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setProperty</span><span class=p>(</span><span class=s>&#34;hibernate.connection.url&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;jdbc:mysql://localhost:3306/hibernate_study?serverTimezone=UTC&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setProperty</span><span class=p>(</span><span class=s>&#34;hibernate.connection.username&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;dev&#34;</span><span class=p>).</span><span class=na>setProperty</span><span class=p>(</span><span class=s>&#34;hibernate.connection.password&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;123456&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>buildSessionFactory</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>setProperties方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 实例化Properties对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Properties</span><span class=w> </span><span class=n>prs</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Properties</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>prs</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;hibernate.dialect&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;org.hibernate.dialect.MysqlDialect&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>prs</span><span class=p>.</span><span class=na>put</span><span class=p>(</span><span class=s>&#34;hibernate.connection.driver_class&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;com.mysql.cj.jdbc.Driver&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 设置配置</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>new</span><span class=w> </span><span class=n>Configuration</span><span class=p>().</span><span class=na>configure</span><span class=p>().</span><span class=na>setProperties</span><span class=p>(</span><span class=n>prs</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ol><h3 id=打开会话>打开会话</h3><p>当获得SeesionFactory后，就可以通过factory来开启Session会话。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 开户一个会话</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Session</span><span class=w> </span><span class=n>session</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>FACTORY</span><span class=p>.</span><span class=na>openSession</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>coding</span><span class=p>...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 使用完成后关闭会话</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>session</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 也可以通过factory关闭所有已打开的会话，这是不安全的</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//FACTORY.close();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=hql-hibernate-query-language>HQL (hibernate query language)</h2><p><code>HQL</code>的语法和<code>T-SQL</code>的语法大致相同，不过HQL是对对象进行操作（对象已经和相应的表进行映射 ），而T-SQL直接针对的是表。使用HQL的<code>INSERT</code>语句时需要注意，INSERT语句不允许直接插入新的对象数据，但是可以将一个对象的信息插入另一个对象（与<code>SELECT</code>语句结合使用）。</p><h3 id=select语句>SELECT语句</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 如果要查询某个对象的所有属性，可以省略SELECT</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 注意这里的User是实体，而不是表名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;FROM User&#34;</span><span class=p>;</span><span class=w>		</span><span class=c1>// 等效于 &#34;SELECT * FROM User&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 创建查询</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>session</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>hql</span><span class=p>);</span><span class=w>		</span><span class=c1>// =&gt; 返回Query对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 可以将User.class传入</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>session</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>hql</span><span class=p>,</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>	</span><span class=c1>// =&gt; 返回Query&lt;User&gt;对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 最后可以通过list()方法来获取结果集</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>session</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>hql</span><span class=p>,</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>list</span><span class=p>();</span><span class=w>		</span><span class=c1>// getResultsList()调用的是list()方法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 只需要获取一个结果，可以使用getSingleResult()方法，直接返回一个User对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>session</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>hql</span><span class=p>,</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>getSingleResult</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>查询单个属性或者多个属性时，必要的时候需要将结果存入map中，方便对数据进行读取。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 只查询id属性</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;SELECT id FROM User&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Session</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>hql</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 获取结果集</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=w> </span><span class=n>list</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>query</span><span class=p>.</span><span class=na>list</span><span class=p>();</span><span class=w>		</span><span class=c1>// 返回的是含有属性值的列表</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 可以转换为map</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=w> </span><span class=n>list1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>query</span><span class=p>.</span><span class=na>setResultTransformer</span><span class=p>(</span><span class=n>Criteria</span><span class=p>.</span><span class=na>ALIAS_TO_ENTITY_MAP</span><span class=p>).</span><span class=na>list</span><span class=p>();</span><span class=w>  </span><span class=c1>// 返回含有map的list列表</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 对于多个属性的查询，以上的转换是非常必要的，否则只能得到Object对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 注意：hibernate的很多方法已经弃用，包括setResultTransformer方法。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 实际上对于简单的CRUD，可以通过hibernate封装的find、save、saveOrUpdate、delete方法来操作实体。</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;SELECT id, name FROM User&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>query1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>hql</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>List</span><span class=w> </span><span class=n>list2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>query1</span><span class=p>.</span><span class=na>setResultTransformer</span><span class=p>(</span><span class=n>Criteria</span><span class=p>.</span><span class=na>ALIAS_TO_ENTITY_MAP</span><span class=p>).</span><span class=na>list</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=动态参数>动态参数</h3><p>曾几何时，使用jdbc的时候，使用"?&ldquo;作为占位符。现在使用hibernate绑定参数变得更加方便，可以使用&rdquo;:<parameter-name>&ldquo;的方式，或者使用jpa的占位格式，&rdquo;?<parameter-index>"。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 绑定参数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;UPDATE User Set name = :name, pass = :pass WHERE id = :id&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 对于非查询操作，记得开启事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Transaction</span><span class=w> </span><span class=n>tx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sexxion</span><span class=p>.</span><span class=na>beginTransaction</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>hql</span><span class=p>,</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>query</span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;name&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;newName&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>query</span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;pass&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;newPass&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>query</span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>query</span><span class=p>.</span><span class=na>executeUpdate</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 提交当前事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>tx</span><span class=p>.</span><span class=na>commit</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 使用jpa的占位符格式</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// jpa的格式的问号加上参数索引的方式</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 即 &#34;?&lt;parameter-index&gt;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 注意：索引下标是从0开始的</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;FROM User WHERE id = ?0&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>hql</span><span class=p>,</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>query</span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=n>0</span><span class=p>,</span><span class=w> </span><span class=n>1</span><span class=p>);</span><span class=w>		</span><span class=c1>// fistr param is index</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>query</span><span class=p>.</span><span class=na>list</span><span class=p>());</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=delete语句>DELETE语句</h3><p>在实际的测试中，对于非查询的语句需要开启事务，否则将会出现异常。其次与查询不同的是需要调用<code>executeUpdate()</code>方法来执行非查询操作。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;DELETE FROM User WHERE id = 1&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 开启事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Transaction</span><span class=w> </span><span class=n>tx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>beginTransaction</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 执行delete</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>res</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>hql</span><span class=p>).</span><span class=na>executeUpdate</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 提交事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>tx</span><span class=p>.</span><span class=na>commit</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>HibernateException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>tx</span><span class=p>.</span><span class=na>rollback</span><span class=p>();</span><span class=w> </span><span class=c1>// 回滚</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 关闭session</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>session</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>return</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=update语句>UPDATE语句</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;UPDATE User SET name = &#39;llzero&#39;, pass = &#39;123456&#39; WHERE id = 1&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 开启事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Transaction</span><span class=w> </span><span class=n>tx</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>beginTransaction</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=w> </span><span class=n>res</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>hql</span><span class=p>).</span><span class=na>executeUpdate</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 提交事务</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>tx</span><span class=p>.</span><span class=na>commit</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>HibernateException</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>e</span><span class=p>.</span><span class=na>printStackTrace</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>tx</span><span class=p>.</span><span class=na>rollback</span><span class=p>();</span><span class=w> </span><span class=c1>// 回滚</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=k>finally</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 关闭session</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>session</span><span class=p>.</span><span class=na>close</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>return</span><span class=w> </span><span class=o>-</span><span class=n>1</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=insert语句>INSERT语句</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 注意：INSERT不能用于直接插入对象，只有用于复制对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 不像T-SQL一样，有VALUES关键字</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 复制id为1的对象的pass和sex属性，并产生一个name为&#39;llZero&#39;的新对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;INSERT INTO User(name, pass, sex) SELECT &#39;llZero&#39;, pass, sex FROM User WHERE id = 1&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>...</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=where-子句>WHERE 子句</h3><p><code>WHERE子句</code>能够对查询的数据进行filter，支持使用<code>AND</code>和<code>OR</code>关键字来组合逻辑，其中表达式符号有"="、"!="、">"、">="、"&lt;"、"&lt;=&ldquo;以及&rdquo;()&ldquo;等。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;FROM User WHERE id = 1 OR id = 3 OR id &gt;= 10&#34;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=as关键字>AS关键字</h3><p>AS可以为表或者某一属性取别名。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;SELECT U.id AS uid, U.name AS uname FROM User AS U&#34;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=order-by-排序>ORDER BY 排序</h3><p>对于排序，同T-SQL一样，使用<code>ORDER BY</code>关键字，多个参与排序的属性使用“,”隔开。</p><p>DESC : 降序</p><p>ASC (默认): 升序</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;FROM User ORDER BY name, id DESC&#34;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=group-by-分组>GROUP BY 分组</h3><p>hql的分组同T-SQL一致，多个参与分组的属性采用半角逗号隔开。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;FROM User GROUP BY name, pass&#34;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=分页查询>分页查询</h3><p>hibernate的分页查询通过调用两个方法来实现，其效果和<code>LIMIT</code>关键字相同。</p><p>setFirstResult(int resultPoint) : 开始读取的位置</p><p>setMaxResults(int num) : 每次最大多少条数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;FROM User&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 以下语句从第四个对象开始读取，最多返回5个对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>createQuery</span><span class=p>(</span><span class=n>hql</span><span class=p>,</span><span class=w> </span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>).</span><span class=na>setFirstResult</span><span class=p>(</span><span class=n>3</span><span class=p>).</span><span class=na>setMaxRusults</span><span class=p>(</span><span class=n>5</span><span class=p>).</span><span class=na>list</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=聚合函数>聚合函数</h3><div class=table-wrapper><table><thead><tr><th style=text-align:left>S.N.</th><th style=text-align:left>方法</th><th style=text-align:left>描述</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>avg(property name)</td><td style=text-align:left>属性的平均值</td></tr><tr><td style=text-align:left>2</td><td style=text-align:left>count(property name or *)</td><td style=text-align:left>属性在结果中出现的次数</td></tr><tr><td style=text-align:left>3</td><td style=text-align:left>max(property name)</td><td style=text-align:left>属性值的最大值</td></tr><tr><td style=text-align:left>4</td><td style=text-align:left>min(property name)</td><td style=text-align:left>属性值的最小值</td></tr><tr><td style=text-align:left>5</td><td style=text-align:left>sum(property name)</td><td style=text-align:left>属性值的总和</td></tr></tbody></table></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 使用count的例子</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>hql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;SELECT count(pass) AS pCount FROM User Group By pass&#34;</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=标准查询>标准查询</h2><p>hibernate的标查询使用到的Class是<code>Criteria</code>，其实质是将hql进行<strong>分拆</strong>再<strong>组合</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>Criteria</span><span class=w> </span><span class=n>cr</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>createCriteria</span><span class=p>(</span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>cr</span><span class=p>.</span><span class=na>list</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 对标准的限制</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 使用add方法来添加对标准的限制</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Restrictions中定义相关限制</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>eq</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>cr</span><span class=p>.</span><span class=na>list</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>isNull</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>isNotNull</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>isEmpty</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>isNotEmpty</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>ge</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>10</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>le</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>20</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>gt</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>30</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>lt</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>40</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 模糊查询，使用&#34;%&#34;或&#34;_&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>like</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;5%&#34;</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 值区间</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>between</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>2</span><span class=p>,</span><span class=w> </span><span class=n>5</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// AND或OR条件</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Criterion</span><span class=w> </span><span class=n>cr1</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Restrictions</span><span class=p>.</span><span class=na>eq</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Criterion</span><span class=w> </span><span class=n>cr2</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Restrictions</span><span class=p>.</span><span class=na>eq</span><span class=p>(</span><span class=s>&#34;pass&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;123456&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>and</span><span class=p>(</span><span class=n>cr1</span><span class=p>,</span><span class=w> </span><span class=n>cr2</span><span class=p>)).</span><span class=na>list</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>cr</span><span class=p>.</span><span class=na>add</span><span class=p>(</span><span class=n>Restrictions</span><span class=p>.</span><span class=na>or</span><span class=p>(</span><span class=n>cr1</span><span class=p>,</span><span class=w> </span><span class=n>cr2</span><span class=p>)).</span><span class=na>list</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 分页</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>cr</span><span class=p>.</span><span class=na>setFirstResult</span><span class=p>(</span><span class=n>2</span><span class=p>).</span><span class=na>setMaxResults</span><span class=p>(</span><span class=n>2</span><span class=p>).</span><span class=na>list</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 排序，使用Order类</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 注意addOrder方法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>cr</span><span class=p>.</span><span class=na>addOrder</span><span class=p>(</span><span class=n>Order</span><span class=p>.</span><span class=na>desc</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>)).</span><span class=na>list</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 预测与聚合</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// Projections类中的方法有求最值、平均值等的方法</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>cr</span><span class=p>.</span><span class=na>setProjection</span><span class=p>(</span><span class=n>Projections</span><span class=p>.</span><span class=na>avg</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>)));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>cr</span><span class=p>.</span><span class=na>setProjection</span><span class=p>(</span><span class=n>Projections</span><span class=p>.</span><span class=na>max</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>)).</span><span class=na>list</span><span class=p>());</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=原生查询>原生查询</h2><p>hibernate除了支持HQL与标准查询以外，同样也可以使用原生的SQL语句进行查询。但是并不建议那么做，因为不同的DBMS的语法存在出入，可能会为移植带来不便。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;SELECT * FROM user&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>NativeQuery</span><span class=w> </span><span class=n>sqlQuery</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>createSQLQuery</span><span class=p>(</span><span class=n>sql</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>sqlQuery</span><span class=p>.</span><span class=na>list</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 标量查询</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;SELECT id,name FROM user&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>NativeQuery</span><span class=w> </span><span class=n>sqlQuery</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>createSQLQuery</span><span class=p>(</span><span class=n>sql</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 把结果转换为map对象</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Query</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>sqlQuery</span><span class=p>.</span><span class=na>setResultTransformer</span><span class=p>(</span><span class=n>Criteria</span><span class=p>.</span><span class=na>ALIAS_TO_ENTITY_MAP</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>query</span><span class=p>.</span><span class=na>list</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 实体查询</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 通过SqlQuery的addEntity(O)方法添加实体映射数据</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;SELECT * FROM user&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>SQLQuery</span><span class=w> </span><span class=n>sqlQuery</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>createSQLQuery</span><span class=p>(</span><span class=n>sql</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 绑定的实体</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sqlQuery</span><span class=p>.</span><span class=na>addEntity</span><span class=p>(</span><span class=s>&#34;cn.llzero.entity.User&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sqlQuery</span><span class=p>.</span><span class=na>addEntity</span><span class=p>(</span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>sqlQuery</span><span class=p>.</span><span class=na>list</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 动态参数</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 可以参考HQL</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;SELECT * FROM user WHERE id = :id&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>SQLQuery</span><span class=w> </span><span class=n>sqlQuery</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>session</span><span class=p>.</span><span class=na>createSQLQuery</span><span class=p>(</span><span class=n>sql</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sqlQuery</span><span class=p>.</span><span class=na>addEntity</span><span class=p>(</span><span class=s>&#34;cn.llzero.entity.User&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>sqlQuery</span><span class=p>.</span><span class=na>setParameter</span><span class=p>(</span><span class=s>&#34;id&#34;</span><span class=p>,</span><span class=w> </span><span class=n>3</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=n>sqlQuery</span><span class=p>.</span><span class=na>getSingleResult</span><span class=p>());</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=interceptor-拦截器>interceptor 拦截器</h2><p>实现hibernate的拦截器有两种方式，一种是实现Interceptor接口，还有一种就是继承EmptyInterceptor空拦截器选择性的重写自己想要实现的方法。</p><p>Interceptor的定义如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>interface</span> <span class=nc>Interceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>boolean</span><span class=w> </span><span class=nf>onLoad</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>var2</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>var3</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>var4</span><span class=p>,</span><span class=w> </span><span class=n>Type</span><span class=o>[]</span><span class=w> </span><span class=n>var5</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>boolean</span><span class=w> </span><span class=nf>onFlushDirty</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>var2</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>var3</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>var4</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>var5</span><span class=p>,</span><span class=w> </span><span class=n>Type</span><span class=o>[]</span><span class=w> </span><span class=n>var6</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>boolean</span><span class=w> </span><span class=nf>onSave</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>var2</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>var3</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>var4</span><span class=p>,</span><span class=w> </span><span class=n>Type</span><span class=o>[]</span><span class=w> </span><span class=n>var5</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>onDelete</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>var2</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>var3</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>var4</span><span class=p>,</span><span class=w> </span><span class=n>Type</span><span class=o>[]</span><span class=w> </span><span class=n>var5</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>onCollectionRecreate</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>var2</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>onCollectionRemove</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>var2</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>onCollectionUpdate</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>var2</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>preFlush</span><span class=p>(</span><span class=n>Iterator</span><span class=w> </span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>postFlush</span><span class=p>(</span><span class=n>Iterator</span><span class=w> </span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Boolean</span><span class=w> </span><span class=nf>isTransient</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=nf>findDirty</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>var2</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>var3</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>var4</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>var5</span><span class=p>,</span><span class=w> </span><span class=n>Type</span><span class=o>[]</span><span class=w> </span><span class=n>var6</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Object</span><span class=w> </span><span class=nf>instantiate</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>EntityMode</span><span class=w> </span><span class=n>var2</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>var3</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=nf>getEntityName</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>var1</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Object</span><span class=w> </span><span class=nf>getEntity</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>var1</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>var2</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>afterTransactionBegin</span><span class=p>(</span><span class=n>Transaction</span><span class=w> </span><span class=n>var1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>beforeTransactionCompletion</span><span class=p>(</span><span class=n>Transaction</span><span class=w> </span><span class=n>var1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kt>void</span><span class=w> </span><span class=nf>afterTransactionCompletion</span><span class=p>(</span><span class=n>Transaction</span><span class=w> </span><span class=n>var1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=cm>/** @deprecated */</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Deprecated</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>String</span><span class=w> </span><span class=nf>onPrepareStatement</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>var1</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>编写<code>HibernateInterceptor</code>类，并继承<code>EmptyInterceptor</code>重写方法。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>HibernateInterceptor</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>EmptyInterceptor</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onDelete</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>entity</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>propertyNames</span><span class=p>,</span><span class=w> </span><span class=n>Type</span><span class=o>[]</span><span class=w> </span><span class=n>types</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;on delete!&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>onDelete</span><span class=p>(</span><span class=n>entity</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=n>propertyNames</span><span class=p>,</span><span class=w> </span><span class=n>types</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>onFlushDirty</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>entity</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>currentState</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>previousState</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>propertyNames</span><span class=p>,</span><span class=w> </span><span class=n>Type</span><span class=o>[]</span><span class=w> </span><span class=n>types</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;on flush dirty&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>onFlushDirty</span><span class=p>(</span><span class=n>entity</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>currentState</span><span class=p>,</span><span class=w> </span><span class=n>previousState</span><span class=p>,</span><span class=w> </span><span class=n>propertyNames</span><span class=p>,</span><span class=w> </span><span class=n>types</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>onLoad</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>entity</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>propertyNames</span><span class=p>,</span><span class=w> </span><span class=n>Type</span><span class=o>[]</span><span class=w> </span><span class=n>types</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;on load&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>onLoad</span><span class=p>(</span><span class=n>entity</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=n>propertyNames</span><span class=p>,</span><span class=w> </span><span class=n>types</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>boolean</span><span class=w> </span><span class=nf>onSave</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>entity</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>propertyNames</span><span class=p>,</span><span class=w> </span><span class=n>Type</span><span class=o>[]</span><span class=w> </span><span class=n>types</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;on save&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>onSave</span><span class=p>(</span><span class=n>entity</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>state</span><span class=p>,</span><span class=w> </span><span class=n>propertyNames</span><span class=p>,</span><span class=w> </span><span class=n>types</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>postFlush</span><span class=p>(</span><span class=n>Iterator</span><span class=w> </span><span class=n>entities</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;post flush&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>postFlush</span><span class=p>(</span><span class=n>entities</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>preFlush</span><span class=p>(</span><span class=n>Iterator</span><span class=w> </span><span class=n>entities</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;pre flush&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>preFlush</span><span class=p>(</span><span class=n>entities</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Boolean</span><span class=w> </span><span class=nf>isTransient</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>entity</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;isTransient&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>isTransient</span><span class=p>(</span><span class=n>entity</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>instantiate</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>entityName</span><span class=p>,</span><span class=w> </span><span class=n>EntityMode</span><span class=w> </span><span class=n>entityMode</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;instantiate&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>instantiate</span><span class=p>(</span><span class=n>entityName</span><span class=p>,</span><span class=w> </span><span class=n>entityMode</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>int</span><span class=o>[]</span><span class=w> </span><span class=nf>findDirty</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>entity</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>currentState</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>previousState</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>propertyNames</span><span class=p>,</span><span class=w> </span><span class=n>Type</span><span class=o>[]</span><span class=w> </span><span class=n>types</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;findDirty&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>findDirty</span><span class=p>(</span><span class=n>entity</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>,</span><span class=w> </span><span class=n>currentState</span><span class=p>,</span><span class=w> </span><span class=n>previousState</span><span class=p>,</span><span class=w> </span><span class=n>propertyNames</span><span class=p>,</span><span class=w> </span><span class=n>types</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>getEntityName</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>object</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;getEntityName&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>getEntityName</span><span class=p>(</span><span class=n>object</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>Object</span><span class=w> </span><span class=nf>getEntity</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>entityName</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>id</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;getEntity&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>getEntity</span><span class=p>(</span><span class=n>entityName</span><span class=p>,</span><span class=w> </span><span class=n>id</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>afterTransactionBegin</span><span class=p>(</span><span class=n>Transaction</span><span class=w> </span><span class=n>tx</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;afterTransactionBegin&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>afterTransactionBegin</span><span class=p>(</span><span class=n>tx</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>afterTransactionCompletion</span><span class=p>(</span><span class=n>Transaction</span><span class=w> </span><span class=n>tx</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;afterTransactionCompletion&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>afterTransactionCompletion</span><span class=p>(</span><span class=n>tx</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>beforeTransactionCompletion</span><span class=p>(</span><span class=n>Transaction</span><span class=w> </span><span class=n>tx</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;beforeTransactionCompletion&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>beforeTransactionCompletion</span><span class=p>(</span><span class=n>tx</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=nf>onPrepareStatement</span><span class=p>(</span><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;onPrepareStatement&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=kd>super</span><span class=p>.</span><span class=na>onPrepareStatement</span><span class=p>(</span><span class=n>sql</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onCollectionRemove</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>collection</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;onCollectionRemove&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>onCollectionRemove</span><span class=p>(</span><span class=n>collection</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onCollectionRecreate</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>collection</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;onCollectionRecreate&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>onCollectionRecreate</span><span class=p>(</span><span class=n>collection</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nd>@Override</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>public</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>onCollectionUpdate</span><span class=p>(</span><span class=n>Object</span><span class=w> </span><span class=n>collection</span><span class=p>,</span><span class=w> </span><span class=n>Serializable</span><span class=w> </span><span class=n>key</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>CallbackException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;onCollectionUpdate&#34;</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=kd>super</span><span class=p>.</span><span class=na>onCollectionUpdate</span><span class=p>(</span><span class=n>collection</span><span class=p>,</span><span class=w> </span><span class=n>key</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=拦截器常用方法解释>拦截器常用方法解释</h3><blockquote><p>findDirty()
这个方法在当 flush() 方法在一个 Session 对象上被调用时被调用。
instantiate()
这个方法在一个持续的类被实例化时被调用。
isUnsaved()
这个方法在当一个对象被传到 saveOrUpdate() 方法时被调用。
onDelete()
这个方法在一个对象被删除前被调用。
onFlushDirty()
这个方法在当 Hibernate 探测到一个对象在一次 flush（例如，更新操作）中是脏的（例如，被修改）时被调用。
onLoad()
这个方法在一个对象被初始化之前被调用。
onSave()
这个方法在一个对象被保存前被调用。
postFlush()
这个方法在一次 flush 已经发生并且一个对象已经在内存中被更新后被调用。
preFlush()
这个方法在一次 flush 前被调用。</p></blockquote><h3 id=使用自定义拦截器>使用自定义拦截器</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 对于所有的会话</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 通过setInterceptor方法指定拦截器</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>SessionFactory</span><span class=w> </span><span class=n>FACTORY</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Configuration</span><span class=p>().</span><span class=na>configure</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setInterceptor</span><span class=p>(</span><span class=k>new</span><span class=w> </span><span class=n>HibernateInterceptor</span><span class=p>()).</span><span class=na>addAnnotatedClass</span><span class=p>(</span><span class=n>User</span><span class=p>.</span><span class=na>class</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>buildSessionFactory</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=hibernate缓存>hibernate缓存</h2><p>使用 <code>session.flush()</code> 和 <code>session.clear()</code> 可以同步缓存和清理内存中的缓存，hibernate默认使用的CacheProvider是EHCache。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/spring/>Spring</a>
<a href=/tags/hibernate/>Hibernate</a>
<a href=/tags/spring-data-jpa/>Spring-Data-Jpa</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/post/framework/spring/spring-context-util/><div class=article-details><h2 class=article-title>Spring启动时，将SpringContext设置到Util中（SpringContextUtil）</h2></div></a></article><article><a href=/post/framework/spring/spring-security-using-browser-cache/><div class=article-details><h2 class=article-title>使用Spring-Security后，浏览器不能缓存的问题</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2021 -
2024 BY CPoet</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.26.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=/libs/photo-swipe/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=/libs/photo-swipe/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=/libs/photo-swipe/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=/libs/photo-swipe/photoswipe.min.css crossorigin=anonymous></main></div><script src=/libs/vibrant/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>